<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/case.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const tg = window.Telegram.WebApp;
            const user = tg.initDataUnsafe.user;

            if (user) {
                document.getElementById('username').textContent = user.username || `ID: ${user.id}`;
                document.getElementById('user-id').textContent = `ID: ${user.id}`;
                
                if (user.photo_url) {
                    document.getElementById('user-avatar').src = user.photo_url;
                } else {
                    console.warn("–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π.");
                    document.getElementById('user-avatar').src = "../avatar.png";
                }
            } else {
                console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram SDK");
                document.getElementById('username').textContent = "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö";
                document.getElementById('user-id').textContent = "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å";
            }

            let balance = localStorage.getItem("balance") || "0";
            document.getElementById("balance").textContent = balance;

            const texts = {
                en: {
                    title: "CS2 Case",
                    deposited: "Total deposited:",
                    cases: "Cases opened:",
                    registered: "Registered:",
                    walletStatus: "Connected",
                    back: "‚Æå Exit to Menu",
                    balanceLabel: "Balance: "
                },
                ru: {
                    title: "CS2 Case",
                    deposited: "–í—Å–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–æ:",
                    cases: "–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤:",
                    registered: "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:",
                    walletStatus: "–ü–æ–¥–∫–ª—é—á–µ–Ω",
                    back: "‚Æå –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                    balanceLabel: "–ë–∞–ª–∞–Ω—Å: "
                }
            };

            const languageSelector = document.getElementById("language-selector");
            const lang = localStorage.getItem("lang") || "en";
            languageSelector.value = lang;
            updateLanguage(lang);

            languageSelector.addEventListener("change", function() {
                const selectedLang = languageSelector.value;
                localStorage.setItem("lang", selectedLang);
                updateLanguage(selectedLang);
            });

            function updateLanguage(lang) {
                document.getElementById("title").textContent = texts[lang].title;
                document.getElementById("balance-label").textContent = texts[lang].balanceLabel;
                document.getElementById("back-button").textContent = texts[lang].back;
            }
        });
    </script>
</head>
<body>
    <div class="notch">
        <h2 id="title">MY PROFILE</h2>
        <div class="balance-container">
            <p id="balance-label">Balance:</p>
            <p id="balance">0</p>
        </div>
        <select id="language-selector" class="language-selector">
            <option value="en">üá∫üá∏</option>
            <option value="ru">üá∑üá∫</option>
        </select>
    </div>

    <div class="container">
        <button id="back-button" class="exit-button" onclick="window.location.href='main.html'">‚Æå Exit to Menu</button>
        
        <div class="profile-header">
            <img id="user-avatar" src="../avatar.png" class="profile-avatar">
            <div>
                <h3 id="username">Loading...</h3>
                <p id="user-id" class="user-id"></p>
            </div>
        </div>
    </div>
</body>
</html>
