<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deposit TON</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/case.css">
    <script src="../js/stars.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <style>
        .deposit-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
            width: 100%;
        }

        .wallet-info {
            text-align: center;
            background: #161825;
            padding: 20px;
            border-radius: 10px;
        }

        .address-box {
            background: #23263a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            word-break: break-all;
            font-family: monospace;
            cursor: pointer;
            position: relative;
        }

        .address-box:hover::after {
            content: 'Copy';
            position: absolute;
            right: 10px;
            background: #2962ff;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 12px;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        #amount-input {
            flex: 1;
            padding: 12px;
            background: #161825;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
        }

        .qr-section {
            text-align: center;
            background: #161825;
            padding: 20px;
            border-radius: 10px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 15px auto;
            background: white;
            padding: 10px;
        }

        .memo-section {
            background: #161825;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .memo-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .memo-value {
            font-family: monospace;
            word-break: break-all;
            color: #4caf50; /* –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è ID */
        }

        .memo-error {
            color: #ff4757; /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—à–∏–±–∫–∏ */
            font-style: italic;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            const tg = window.Telegram.WebApp;
            tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            
            // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ Telegram
            const userId = tg.initDataUnsafe.user?.id;
            const memoContainer = document.getElementById("memo-value");
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞
            const walletAddress = "UQBwpx78QFjSxoNDzksZT4DHbEHnGFg8Gbgw9SjYY_bP9M3R";
            document.getElementById("wallet-address").textContent = walletAddress;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ ID –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            if (userId) {
                memoContainer.textContent = userId;
                memoContainer.className = "memo-value";
            } else {
                memoContainer.textContent = "Telegram ID –¥–ª—è memo –Ω–µ –Ω–∞–π–¥–µ–Ω";
                memoContainer.className = "memo-error";
            }
            
            // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ
            document.getElementById("wallet-address").addEventListener("click", function() {
                navigator.clipboard.writeText(walletAddress).then(() => {
                    alert("Wallet address copied!");
                });
            });

            // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ID –ø—Ä–∏ –∫–ª–∏–∫–µ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
            if (userId) {
                memoContainer.addEventListener("click", function() {
                    navigator.clipboard.writeText(userId).then(() => {
                        alert("User ID copied!");
                    });
                });
            }

            let balance = localStorage.getItem("balance") || "0";
            document.getElementById("balance").textContent = balance;

            const texts = {
                en: {
                    title: "CS2 Case",
                    walletTitle: "Your TON Wallet",
                    scanText: "Scan QR code to deposit",
                    confirm: "Confirm",
                    back: "‚Æå Exit to Menu",
                    balanceLabel: "Balance:",
                    memoLabel: "Your Telegram ID (required for deposit):",
                    copyAlert: "Copied!",
                    amountPlaceholder: "Amount",
                    idNotFound: "Telegram ID for memo not found"
                },
                ru: {
                    title: "CS2 Case",
                    walletTitle: "–í–∞—à TON –∫–æ—à–µ–ª–µ–∫",
                    scanText: "–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥",
                    confirm: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
                    back: "‚Æå –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                    balanceLabel: "–ë–∞–ª–∞–Ω—Å:",
                    memoLabel: "–í–∞—à Telegram ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞):",
                    copyAlert: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
                    amountPlaceholder: "–°—É–º–º–∞",
                    idNotFound: "Telegram ID –¥–ª—è memo –Ω–µ –Ω–∞–π–¥–µ–Ω"
                }
            };

            const languageSelector = document.getElementById("language-selector");
            const lang = localStorage.getItem("lang") || "en";
            languageSelector.value = lang;
            updateLanguage(lang);

            languageSelector.addEventListener("change", function() {
                const selectedLang = languageSelector.value;
                localStorage.setItem("lang", selectedLang);
                updateLanguage(selectedLang);
            });

            function updateLanguage(lang) {
                document.getElementById("title").textContent = texts[lang].title;
                document.getElementById("wallet-title").textContent = texts[lang].walletTitle;
                document.getElementById("scan-text").textContent = texts[lang].scanText;
                document.getElementById("confirm-deposit").textContent = texts[lang].confirm;
                document.getElementById("back-button").textContent = texts[lang].back;
                document.getElementById("balance-label").textContent = texts[lang].balanceLabel;
                document.getElementById("memo-label").textContent = texts[lang].memoLabel;
                document.getElementById("amount-input").placeholder = texts[lang].amountPlaceholder;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ ID –Ω–µ –Ω–∞–π–¥–µ–Ω
                if (!userId) {
                    document.getElementById("memo-value").textContent = texts[lang].idNotFound;
                }
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ —Å –∞–¥—Ä–µ—Å–æ–º –∏ memo (–µ—Å–ª–∏ ID –¥–æ—Å—Ç—É–ø–µ–Ω)
            function generateQR() {
                let qrData = `ton://transfer/${walletAddress}`;
                if (userId) {
                    qrData += `?text=${userId}`;
                }
                
                const qrCode = document.getElementById("qr-code");
                qrCode.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrData)}`;
            }
            
            generateQR();
        });
    </script>
</head>
<body>
    <div class="notch">
        <h2 id="title">DEPOSIT TON</h2>
        <div class="balance-container">
            <p id="balance-label">Balance:
                
            </p>
            <p id="balance">0</p>
        </div>
        <select id="language-selector" class="language-selector">
            <option value="en">üá∫üá∏</option>
            <option value="ru">üá∑üá∫</option>
        </select>
    </div>
    
    <div class="container">
        <button id="back-button" class="exit-button" onclick="window.location.href='main.html'">‚Æå Exit to Menu</button>
        
        <div class="deposit-section">
            <div class="wallet-info">
                <img src="../icons/wallet.svg" alt="wallet" class="sticker">
                <h3 id="wallet-title">Your TON Wallet</h3>
                <div class="address-box" id="wallet-address">
                    Loading...
                </div>
            </div>
            
            <div class="memo-section">
                <div class="memo-label" id="memo-label">Your Telegram ID (required for deposit):</div>
                <div id="memo-value">Loading...</div>
            </div>
            
            <div class="input-group">
                <input type="number" placeholder="Amount" id="amount-input">
                <button class="button" id="confirm-deposit">Confirm</button>
            </div>
            
            <div class="qr-section">
                <img id="qr-code" alt="qr-code" class="qr-code">
                <p id="scan-text">Scan QR code to deposit</p>
            </div>
        </div>
    </div>
</body>
</html>
